---
path: /react-form-control
created: "2020-09-26"
title: Reactのフォームをコントロールするデメリットについて考える
visual: "./visual.png"
tags: [React, お気持ち]
userId: sadnessOjisan
isFavorite: false
isProtect: false
---

`<input onChange={handleChange}></input>` のような onChange ってやるべきなのかなぁって疑問に思っているので自分の考えをまとめます。

## React は制御されたコンポーネントを推奨している

まず制御されたコンポーネントについて、公式の定義をみましょう。

> HTML では `<input>`、`<textarea>`、そして `<select>` のようなフォーム要素は通常、自身で状態を保持しており、ユーザの入力に基づいてそれを更新します。React では、変更されうる状態は通常はコンポーネントの state プロパティに保持され、setState() 関数でのみ更新されます。React の state を “信頼できる唯一の情報源 (single source of truth)” とすることで、上述の 2 つの状態を結合させることができます。そうすることで、フォームをレンダーしている React コンポーネントが、後続するユーザ入力でフォームで起きることも制御できるようになります。このような方法で React によって値が制御される入力フォーム要素は「制御されたコンポーネント」と呼ばれます。

FYI: https://ja.reactjs.org/docs/forms.html#controlled-components

制御されたコンポーネントがあると言うことは制御されていないコンポーネントもあり、その説明では **制御されたコンポーネントの利用の推奨が明記されています**。

> ほとんどの場合では、フォームの実装には制御されたコンポーネントを使用することをお勧めしています。制御されたコンポーネントでは、フォームのデータは React コンポーネントが扱います。非制御コンポーネントはその代替となるものであり、フォームデータを DOM 自身が扱います。

FYI: https://ja.reactjs.org/docs/forms.html#controlled-components

しかし僕は使いたくないです。

## 制御されたコンポーネントを使いたくない

使いたくない理由としては次の 2 つの理由があります。

### パフォーマンスへの懸念

入力のたびにその内容を state に書き込むので、state の階層によっては再レンダリングがたくさん走ります。
コンポーネントの分割や memo などを駆使すればある程度緩和ができるものだとは思いますが、事故の元なので既存コードに memo を入れるのが憚られたりもします。
特に誰かから引き継いだコードだと state 周りのリファクタリングはそれ用の工数をもらわないと厳しいところがあります。

ただこれは Concurrent mode によって緩和されるものだとは思います。

### 制御したい場合のユースケースは本当にメリットなのか

フォームの入力内容を制御したいとき主にその用途はバリデーションと修正だと思います。
（他に何かメリット見落としているかもなのでもしありましたら教えてください。）

しかし入力時にバリデーションや修正って本当に必要でしょうか？
入力後、つまり onBlur のタイミングで行えばいいのではと思っています。
あと個人的には入力内容を onChange でライブ変換されるのは使いにくいと思っています。

## 非制御コンポーネントを使う

### onBlur で同期

### onSubmit で同期

input 一つのフォームでエンターキー押して submit のような実装だと onBlur は実行されません。
その場合は onSubmit を使いましょう。
name 経由でフォームの内容を取得できます。

### 初期値は defaultValue で上書く
